# 数据增强记录 (Data Enrichment Log)

## 1. 背景与目标
针对经过清洗后的菜谱数据（约 20,000 条），存在以下问题：
- **字段缺失或单一**: `cuisine_type` (菜系), `scene_type` (场景), `difficulty` (难度), `flavor_tags` (口味) 字段值为空或分布过于集中（如主要集中在"家常菜"）。
- **图片缺失**: `image_url` 字段为空，导致前端展示效果沉闷，缺乏视觉吸引力。

本数据增强方案旨在通过智能规则和随机算法，为这些字段填充合理且多样化的数据，提升系统演示效果和用户体验。

## 2. 实施方案

### 2.1 脚本信息
- **脚本位置**: `backend/recipes/management/commands/enrich_recipes.py`
- **执行命令**: 
  ```bash
  python manage.py enrich_recipes
  ```
- **验证脚本**: `backend/verify_script/verify_enrichment.py`

### 2.2 增强策略详解

#### A. 菜系分类 (Cuisine Type)
- **关键词映射**: 优先根据菜谱名称匹配关键词。
  - 例：含"川"、"辣" -> 川菜；含"粤"、"煲" -> 粤菜。
  - 覆盖菜系：川菜、粤菜、湘菜、鲁菜、苏菜、浙菜、徽菜、闽菜、东北菜、家常菜、面食、西餐、日韩料理。
- **随机回退机制**: 
  - 若无关键词匹配，使用加权随机分配。
  - 特殊处理：将默认的"家常菜"权重降低至 15%，强制增加其他菜系的分布比例，确保数据多样性。

#### B. 场景分类 (Scene Type)
- **关键词映射**: 根据名称匹配场景。
  - 例："粥"、"早" -> 早餐；"便当" -> 便当；"串" -> 夜宵。
- **逻辑推断**:
  - 甜点/西餐 -> 下午茶
  - 面食 -> 随机分配至 早餐/午餐
- **分布优化**:
  - 其余数据按概率分布：午餐 (20%)、晚餐 (60%)、随机其他 (20%)。

#### C. 难度等级 (Difficulty)
- **名称启发式**:
  - 含"简"、"快手" -> Easy (简单)
  - 含"宴"、"复杂"、"佛跳墙" -> Hard (困难)
- **概率分布**:
  - 简单 (Easy): 30%
  - 中等 (Medium): 50%
  - 困难 (Hard): 20%

#### D. 口味标签 (Flavor Tags)
- **关键词提取**: 扫描名称中的口味词（辣、甜、酸、咸、鲜、苦、麻、香、清淡）。
- **随机补全**:
  - 若提取不到标签，或标签少于 2 个，随机从标签库中补充 1-2 个标签，确保每道菜都有丰富的口味描述。

#### E. 图片填充 (Image URL)
- **服务源**: 使用 `loremflickr.com` 生成高质量占位图。
- **关键词翻译**: 建立中文食材到英文关键词的映射表。
  - 例："鸡" -> `chicken`, "豆腐" -> `tofu`, "蛋糕" -> `cake`.
- **URL 构造**:
  ```
  https://loremflickr.com/800/600/{keyword}?lock={recipe_id}
  ```
  - 使用 `lock={recipe_id}` 参数确保同一道菜在刷新时图片保持不变，同时不同菜谱拥有不同的图片指纹。

#### F. 适用人群 (Target Audience)
- **人群分类**: 儿童、老人、孕妇、健身人群、素食者、大众。
- **关键词映射**:
  - **儿童**: 粥、蛋、饼、奶、萌、软、童、宝宝、小、甜
  - **老人**: 粥、炖、汤、软、烂、蒸、清淡、养生
  - **孕妇**: 汤、鱼、燕窝、补、叶酸、清淡、营养
  - **健身人群**: 鸡胸、牛排、沙拉、蛋白、低脂、全麦、粗粮、蒸、煮
  - **素食者**: 素、斋、豆腐、菌、菇、菜、蔬、豆制品 (同时排除含肉类关键词的菜谱)
- **随机补充**:
  - 未匹配到关键词的菜谱，80% 归为"大众"，20% 随机分配到上述特定人群，以保证数据的丰富度。

## 3. 增强结果验证

执行验证脚本后，数据分布呈现健康状态：

### 分布统计 (示例)
- **菜系**: 面食 (4000+), 家常菜 (3900+), 川菜 (1700+), 粤菜 (1600+), 西餐 (1300+) 等。
- **场景**: 早餐 (6700+), 晚餐 (5400+), 午餐 (5000+), 下午茶 (2000+)。
- **难度**: 中等 (9400+), 简单 (6700+), 困难 (3800+)。
- **适用人群**: 大众 (7700+), 儿童 (6400+), 老人 (2100+), 素食者 (1600+), 孕妇 (1200+), 健身人群 (800+)。
- **图片**: 100% 覆盖率 (0 空值)。

### 效果展示
前端展示不再有空白图片，且筛选器（菜系、场景、难度）均有足够的数据支持，图表分析功能（如口味雷达图、菜系饼图）也能展示出有意义的分布形态。
