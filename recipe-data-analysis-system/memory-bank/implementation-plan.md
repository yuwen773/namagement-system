# 菜谱数据分析系统 - 实施计划

> 本文档为 AI 开发者提供详细的逐步实施说明。每个步骤均包含具体的操作指示和测试验证方法。

---

## 📋 当前项目状态

**更新日期**: 2026-01-29
**当前阶段**: 阶段零 - 项目准备

### 已确认的项目决策

| 决策项 | 决策内容 | 备注 |
|:------|:---------|:-----|
| **数据库状态** | 🔴 未初始化 | 需要执行 `sql/init.sql` 创建数据库 |
| **数据来源** | 🕷️ 爬取数据 | 从下厨房、美食杰等网站爬取 10,000-20,000 条 |
| **当前进度** | 🆕 从零开始 | 需要完整创建前后端项目结构 |
| **开发方式** | 📋 严格按顺序 | 严格执行 22 个阶段，不跳步骤 |
| **缓存方案** | ⚠️ 不使用 Redis | 当前阶段直接访问数据库，暂不引入缓存 |

### 技术栈确认

| 类别 | 技术选择 | 状态 |
|:---|:---------|:----:|
| 前端框架 | Vue 3 (Composition API) | 待安装 |
| UI 组件库 | Element Plus | 待安装 |
| CSS 框架 | Tailwind CSS | 待安装 |
| 图表库 | ECharts | 待安装 |
| 后端框架 | Django 5.2 + DRF | 待安装 |
| 数据库 | MySQL 8.0+ | 待创建 |
| 数据处理 | Pandas + NumPy | 待安装 |
| **缓存** | **不使用 Redis** | **已确认** |

### 22 阶段进度概览

| 阶段 | 名称 | 状态 |
|:---:|:------|:----:|
| 1 | 项目初始化与基础架构 | 🔜 待开始 |
| 2 | 数据库设计与模型创建 | 🔜 待开始 |
| 3 | 数据准备与导入 | 🔜 待开始 |
| 4-7 | 普通用户模块（后端） | 🔜 待开始 |
| 8-11 | 普通用户模块（前端） | 🔜 待开始 |
| 12-16 | 管理员模块 | 🔜 待开始 |
| 17 | 用户行为数据模拟 | 🔜 待开始 |
| 18 | 用户行为分析与可视化 | 🔜 待开始 |
| 19-20 | 优化与部署准备 | 🔜 待开始 |
| 21-22 | 测试验收与交付 | 🔜 待开始 |

---

## 项目概览

**核心目标**：构建一个包含 10,000-20,000 条菜谱数据的综合平台，提供菜谱展示、收藏与深度数据分析功能。

**技术栈（已确认）**：
- 前端：Vue 3 (Composition API) + Element Plus + Tailwind CSS + ECharts
- 后端：Django 5.2 + Django REST Framework
- 数据库：MySQL 8.0+
- 数据处理：Pandas + NumPy
- 认证：JWT
- ⚠️ **注意**：当前阶段不使用 Redis 缓存

---

## 阶段一：项目初始化与基础架构

> **已确认的决策**：
> - 前端使用 **Vite 脚手架** (`npm create vite@latest`)
> - 后端使用 **Django 模板** (`django-admin startproject`)
> - 数据通过 **爬取** 获取（下厨房、美食杰等）
> - 后端 apps: accounts, recipes, categories, ingredients, favorites, analytics, admin_panel, behavior_logs

### 步骤 1.1：使用脚手架创建前端项目

**操作指示**：
- 使用 Vite 脚手架创建 Vue 3 项目：
  ```bash
  npm create vite@latest frontend -- --template vue
  cd frontend
  npm install
  ```
- 安装核心依赖：
  ```bash
  npm install element-plus pinia vue-router axios echarts
  npm install -D tailwindcss postcss autoprefixer
  npx tailwindcss init -p
  ```
- 配置 Tailwind CSS
- 配置 Vue Router 和 Pinia

**测试验证**：
- 运行 `npm run dev`
- 确认开发服务器启动成功（默认 localhost:5173）
- 访问欢迎页面，确认正常显示
- 确认所有依赖包已正确安装（检查 package.json）

---

### 步骤 1.2：使用 Django 模板创建后端项目

**操作指示**：
- 创建虚拟环境：
  ```bash
  python -m venv venv
  source venv/bin/activate  # Windows: venv\Scripts\activate
  ```
- 使用 Django 模板创建项目：
  ```bash
  pip install django djangorestframework django-cors-headers
  django-admin startproject backend config
  cd backend
  ```
- 创建 Django 应用：
  ```bash
  python manage.py startapp accounts
  python manage.py startapp recipes
  python manage.py startapp categories
  python manage.py startapp ingredients
  python manage.py startapp favorites
  python manage.py startapp analytics
  python manage.py startapp admin_panel
  python manage.py startapp behavior_logs
  ```
- 安装其他依赖（JWT、Pandas 等）
- 配置数据库连接（MySQL）
- 创建 utils 模块（response、exceptions、pagination）

**测试验证**：
- 启动后端服务器 `python manage.py runserver`
- 确认服务器启动成功（默认 localhost:8000）
- 访问 Django admin 确认正常
- 配置数据库并测试连接

---

### 步骤 1.3：创建数据脚本目录

**操作指示**：
- 创建 `data-scripts/` 目录
- 创建以下子目录和文件：
  ```
  data-scripts/
  ├── spiders/           # 爬虫脚本
  ├── cleaning/          # 数据清洗脚本
  ├── importing/         # 数据导入脚本
  └── simulation/        # 用户行为模拟脚本
  ```

**测试验证**：
- 确认目录结构已创建
- 创建测试脚本确认可正常运行

---

### 步骤 1.4：配置开发环境

**操作指示**：
- 创建前端 `.env.local` 文件，配置 API 基础路径
- 创建后端 `.env` 文件，配置：
  - 数据库连接信息
  - SECRET_KEY
  - DEBUG 模式
  - 允许的主机
- 更新 `.gitignore` 文件，排除：
  - node_modules/
  - venv/
  - .env
  - __pycache__/
  - *.pyc

**测试验证**：
- 确认环境变量可被正确读取
- 确认前后端能通过配置的端口通信
- 确认敏感信息不会被提交到版本控制

---

## 阶段二：数据库设计与模型创建

### 步骤 2.1：设计用户表结构

**操作指示**：
- 设计用户表，包含以下字段：
  - 主键 ID
  - 用户名（唯一）
  - 密码（加密存储）
  - 邮箱/手机号
  - 昵称
  - 个人简介
  - 角色类型（普通用户/管理员）
  - 创建时间
  - 更新时间
  - 最后登录时间
- 创建数据库迁移文件
- 执行迁移，创建用户表

**测试验证**：
- 连接数据库，确认用户表已创建
- 确认所有字段存在且数据类型正确
- 确认索引已正确创建（用户名、邮箱等唯一索引）
- 尝试插入一条测试数据，确认成功

---

### 步骤 2.2：设计菜谱表结构

**操作指示**：
- 设计菜谱主表，包含以下字段：
  - 主键 ID
  - 菜谱名称
  - 菜系分类
  - 场景分类（早餐、午餐、晚餐等）
  - 适用人群
  - 难度等级
  - 烹饪时长（分钟）
  - 成品图片 URL
  - 详细步骤（文本或 JSON）
  - 口味标签（可多选）
  - 点击量
  - 收藏量
  - 创建时间
  - 更新时间
- 创建数据库迁移文件
- 执行迁移，创建菜谱主表

**测试验证**：
- 确认菜谱表已创建
- 确认所有字段存在且数据类型正确
- 插入一条测试菜谱数据
- 查询该数据，确认所有字段正确存储

---

### 步骤 2.3：设计食材表与关联表

**操作指示**：
- 设计食材表，包含以下字段：
  - 主键 ID
  - 食材名称
  - 食材分类（蔬菜、肉类、调料等）
  - 创建时间
- 设计菜谱-食材关联表，包含：
  - 主键 ID
  - 菜谱 ID（外键）
  - 食材 ID（外键）
  - 用量描述
- 创建数据库迁移文件
- 执行迁移

**测试验证**：
- 确认食材表和关联表已创建
- 确认外键约束正确设置
- 插入测试食材数据
- 创建关联关系，确认多对多关系正确建立

---

### 步骤 2.4：设计收藏表结构

**操作指示**：
- 设计收藏表，包含以下字段：
  - 主键 ID
  - 用户 ID（外键）
  - 菜谱 ID（外键）
  - 收藏时间
  - 联合唯一索引（用户 ID + 菜谱 ID）
- 创建数据库迁移文件
- 执行迁移

**测试验证**：
- 确认收藏表已创建
- 确认联合唯一索引已创建
- 尝试重复收藏同一菜谱，确认被拒绝
- 取消收藏后重新收藏，确认成功

---

### 步骤 2.5：设计用户行为表（用于分析）

**操作指示**：
- 设计用户行为日志表，包含以下字段：
  - 主键 ID
  - 用户 ID（可为空，支持未登录用户）
  - 行为类型（登录、搜索、浏览、收藏等）
  - 行为目标（菜谱 ID 或页面路径）
  - 行为时间
  - 额外数据（JSON 格式，存储搜索关键词、停留时长等）
- 创建数据库迁移文件
- 执行迁移
- 为该表添加索引（用户 ID、行为类型、行为时间）

**测试验证**：
- 确认行为日志表已创建
- 确认索引已正确创建
- 插入测试行为数据
- 查询特定用户的行为记录，确认查询性能

---

### 步骤 2.6：创建分类/标签表

**操作指示**：
- 设计分类表，包含以下字段：
  - 主键 ID
  - 分类名称
  - 分类类型（菜系、场景、人群、口味等）
  - 排序序号
  - 创建时间
- 创建数据库迁移文件
- 执行迁移
- 插入初始分类数据（八大菜系、常见场景等）

**测试验证**：
- 确认分类表已创建
- 确认初始分类数据已插入
- 查询所有菜系分类，确认数据正确

---

## 阶段三：数据准备与导入

> **已确认**：通过爬取获取数据（下厨房、美食杰等）

### 步骤 3.1：分析目标网站

**操作指示**：
- 选择目标网站：下厨房（xiachufang.com）、美食杰（meishij.net）
- 分析网站结构：
  - 菜谱列表页 URL 规律
  - 菜谱详情页 HTML 结构
  - 分页机制
- 分析反爬策略：
  - User-Agent 检测
  - IP 限制
  - 登录要求
- 准备爬虫环境：
  - 安装依赖：requests, beautifulsoup4, lxml
  - 配置 User-Agent 轮换
  - 准备代理 IP（如需要）

**测试验证**：
- 手动访问目标网站，确认可访问
- 使用浏览器开发者工具分析页面结构
- 测试简单的请求，确认不会被立即拦截

---

### 步骤 3.2：编写菜谱爬取脚本

**操作指示**：
- 创建 `data-scripts/spiders/recipe_spider.py`
- 实现以下功能：
  - 请求菜谱列表页
  - 解析菜谱详情页链接
  - 请求并解析菜谱详情页：
    - 菜谱名称
    - 菜系分类
    - 难度等级
    - 烹饪时长
    - 食材列表（含用量）
    - 制作步骤
    - 成品图片 URL
  - 下载图片到本地
  - 处理分页
  - 异常处理和重试机制
- 配置爬取间隔（2-5 秒），避免过载
- 添加进度显示和日志记录
- 数据保存为 JSON 格式

**测试验证**：
- 运行脚本，爬取少量数据（如 10 条）
- 检查数据格式是否正确
- 检查图片是否成功下载
- 确认无异常错误
- 验证数据完整性

---

### 步骤 3.3：编写数据清洗脚本

**背景说明**：
- 数据集 `recipe_corpus_full.json` 约 1.8GB，包含 152 万+ 条菜谱记录
- 需要提取并清洗 20,000 条完整数据入库
- 使用流式处理避免内存溢出

**已完成的脚本**：

| 脚本文件 | 用途 | 状态 |
|:---------|:-----|:----:|
| `cleaning/clean_recipes.py` | 小数据集清洗（一次性加载）| ✅ |
| `cleaning/clean_large_dataset.py` | 大数据集流式清洗 | ✅ |

**clean_large_dataset.py 核心功能**：
- **流式读取**：使用 `ijson` 库逐条解析大 JSON 文件
- **智能去重**：基于 `recipe_id` 和菜谱名称 MD5 哈希
- **数据验证**：确保必需字段完整
- **自动补全**：缺失字段使用合理默认值
- **进度显示**：实时显示清洗进度和有效率
- **可配置**：支持自定义目标数量和批次大小

**数据库必需字段验证**：

| 字段 | 要求 | 默认值 |
|:-----|:-----|:-------|
| name | 必填 | 无（缺失则跳过） |
| ingredients | 至少 1 条 | 无（缺失则跳过） |
| steps | 至少 1 步 | 无（缺失则跳过） |
| cuisine_type | 可选 | "家常菜" |
| scene_type | 可选 | "晚餐" |
| difficulty | 可选 | "medium" |
| cooking_time | 可选 | 30 |
| image_url | 可选 | "" |

**使用方式**：

```bash
cd data-scripts/cleaning

# 安装依赖（推荐）
pip install ijson

# 清洗 20,000 条数据（默认）
python clean_large_dataset.py ../dataset/recipe_corpus_full.json ../output/cleaned_20k_recipes.json

# 自定义目标数量
python clean_large_dataset.py ../dataset/recipe_corpus_full.json ../output/cleaned_10k_recipes.json --target 10000

# 查看帮助
python clean_large_dataset.py --help
```

**输出文件**：
- `cleaned_20k_recipes.json` - 清洗后的数据（含 metadata）
- `cleaning_report.json` - 详细清洗报告

**测试验证**：
- 运行清洗脚本
- 检查清洗后的数据质量
- 确认输出数量达到目标（20,000 条）
- 确认必填字段无缺失
- 查看清洗报告，确认有效率合理

---

### 步骤 3.4：编写数据导入脚本

**输入文件**：
- `data-scripts/output/cleaned_20k_recipes.json` - 清洗后的 20,000 条菜谱数据

**输出目标**：
- MySQL 数据库表：`recipes`, `ingredients`, `recipe_ingredients`, `recipe_steps`

**操作指示**：

创建 `data-scripts/importing/import_recipes.py` 脚本，实现以下功能：

1. **数据读取与解析**
   - 读取清洗后的 JSON 文件
   - 解析 metadata（记录总数、清洗时间等）
   - 验证数据格式完整性

2. **食材预处理**
   - 提取所有唯一食材
   - 创建食材到分类的映射（蔬菜/肉类/调料等）
   - 先批量插入食材到 `ingredients` 表

3. **菜谱批量导入**
   - 使用批量插入优化性能（`bulk_create`）
   - 字段映射：
     | 源字段 | 目标字段 | 处理方式 |
     |:-------|:---------|:---------|
     | `name` | `name` | 直接映射 |
     | `cuisine_type` | `cuisine_type` | 映射到分类表 ID |
     | `difficulty` | `difficulty` | easy/medium/hard |
     | `cooking_time` | `cooking_time` | 分钟数 |
     | `ingredients` | - | 拆分到关联表 |
     | `steps` | - | 拆分到步骤表 |
     | `image_url` | `image_url` | 保留原 URL |

4. **关联数据处理**
   - 批量插入 `recipe_ingredients` 关联表
   - 批量插入 `recipe_steps` 步骤表
   - 处理食材用量描述

5. **生成模拟数据**
   - 点击量：随机生成 100-50000 之间的数
   - 收藏量：点击量的 5%-20%
   - 创建时间：过去 365 天内随机分布

6. **进度显示与错误处理**
   - 实时显示导入进度（已导入/总数）
   - 显示导入速度（条/秒）
   - 记录失败记录到错误日志
   - 支持断点续传（跳过已导入）

**使用方式**：

```bash
cd data-scripts/importing

# 安装依赖
pip install pymysql django

# 先导入少量数据测试（100 条）
python import_recipes.py --limit 100

# 完整导入 20,000 条数据
python import_recipes.py

# 指定输入文件路径
python import_recipes.py --input ../output/cleaned_20k_recipes.json

# 查看帮助
python import_recipes.py --help
```

**输出文件**：
- `import_report.json` - 导入报告（成功数、失败数、耗时）
- `import_errors.log` - 错误日志

**测试验证**：

1. **小批量测试**（100 条）
   ```bash
   python import_recipes.py --limit 100
   ```
   - 检查数据库表记录数
   - 随机抽取 5 条数据验证字段完整性
   - 确认食材关联正确
   - 确认步骤数据完整

2. **全量导入**
   ```bash
   python import_recipes.py
   ```
   - 验证 recipes 表记录数 = 20,000
   - 验证 ingredients 表有 500+ 食材
   - 验证 recipe_ingredients 关联完整
   - 验证 recipe_steps 步骤完整

3. **数据质量检查**
   ```sql
   -- 检查必填字段无 NULL
   SELECT COUNT(*) FROM recipes WHERE name IS NULL;
   SELECT COUNT(*) FROM recipes WHERE cuisine_type IS NULL;

   -- 检查关联数据完整
   SELECT COUNT(*) FROM recipe_ingredients;
   SELECT COUNT(*) FROM recipe_steps;

   -- 检查点击量/收藏量分布
   SELECT
     CASE
       WHEN view_count < 1000 THEN '0-1k'
       WHEN view_count < 10000 THEN '1k-10k'
       ELSE '10k+'
     END AS range,
     COUNT(*) AS count
   FROM recipes
   GROUP BY range;
   ```

**成功标准**：
- 成功导入 20,000 条菜谱记录
- 所有食材已建立正确关联
- 无外键约束错误
- 导入耗时 < 5 分钟
- 导入报告显示成功率 > 95%

---

### 步骤 3.5：执行完整数据导入

**操作指示**：
- 执行完整数据导入
- 监控导入进度
- 记录导入日志
- 处理任何错误数据

**测试验证**：
- 查询数据库总记录数，确认达到 10,000-20,000 条
- 随机抽取 10 条数据检查完整性
- 确认所有菜谱都有图片 URL
- 确认食材关联数据完整

---

### 步骤 3.6：准备图片存储

**操作指示**：
- 确定图片存储方式（本地存储或云存储）
- 若使用本地存储：
  - 创建图片目录
  - 配置静态资源访问
  - 将下载的图片放入正确目录
- 若使用云存储：
  - 配置云存储服务
  - 上传图片
  - 更新图片 URL

**测试验证**：
- 随机选择 10 个图片 URL
- 在浏览器中访问，确认图片可正常显示
- 确认图片加载速度可接受

---

## 阶段四：用户认证与权限系统
> 注意开发接口的时候，严格遵循 [](./backend-api-standards.md) 后端开发规范
### 步骤 4.1：实现用户注册接口

**操作指示**：
- 创建用户注册 API 端点（`POST /api/auth/register`）
- 实现以下功能：
  - 验证用户名唯一性
  - 验证邮箱/手机号格式
  - 验证密码强度（至少 8 位）
  - 密码明文存储
  - 返回注册结果和用户基本信息
- 添加请求参数验证

**测试验证**：
- 使用 API 工具（如 Postman）发送注册请求
- 使用有效数据注册，确认成功
- 尝试重复用户名注册，确认失败并返回正确错误信息
- 尝试使用弱密码，确认被拒绝
- 检查数据库，确认密码已加密存储

---

### 步骤 4.2：实现用户登录接口

**操作指示**：
- 创建用户登录 API 端点（`POST /api/auth/login`）
- 实现以下功能：
  - 验证用户名和密码
  - 生成 JWT Token 或 Session
  - 返回 Token 和用户信息
  - 记录最后登录时间
- 添加请求参数验证

**测试验证**：
- 使用正确的用户名密码登录，确认成功
- 使用错误的用户名密码登录，确认失败
- 检查返回的 Token 是否有效
- 确认最后登录时间已更新

---

### 步骤 4.3：实现 Token 验证中间件

**操作指示**：
- 创建身份验证中间件
- 验证请求头中的 Token
- 解析 Token 获取用户信息
- 将用户信息附加到请求对象
- 处理 Token 过期和无效情况

**测试验证**：
- 创建受保护的测试接口
- 使用有效 Token 访问，确认成功
- 使用无效 Token 访问，确认返回 401
- 不使用 Token 访问，确认返回 401
- 使用过期 Token 访问，确认返回正确错误信息

---

### 步骤 4.4：实现获取当前用户信息接口

**操作指示**：
- 创建获取当前用户信息 API 端点（`GET /api/auth/me`）
- 使用身份验证中间件保护
- 返回当前用户的完整信息（不含密码）

**测试验证**：
- 使用有效 Token 访问，确认返回用户信息
- 确认密码字段未被返回
- 不使用 Token 访问，确认返回 401

---

### 步骤 4.5：实现更新用户信息接口

**操作指示**：
- 创建更新用户信息 API 端点（`PUT /api/auth/me`）
- 使用身份验证中间件保护
- 支持更新以下字段：
  - 昵称
  - 个人简介
- 验证输入数据
- 返回更新后的用户信息

**测试验证**：
- 使用有效 Token 更新昵称
- 查询用户信息，确认昵称已更新
- 尝试更新他人信息，确认失败
- 尝试更新不允许的字段（如用户名），确认被忽略或拒绝

---

### 步骤 4.6：实现修改密码接口

**操作指示**：
- 创建修改密码 API 端点（`PUT /api/auth/password`）
- 使用身份验证中间件保护
- 验证旧密码正确性
- 验证新密码强度
- 更新密码并重新加密
- 返回成功信息

**测试验证**：
- 使用正确的旧密码修改，确认成功
- 使用错误的旧密码修改，确认失败
- 使用弱密码作为新密码，确认被拒绝
- 修改后使用新密码登录，确认成功

---

### 步骤 4.7：实现角色权限控制

**操作指示**：
- 创建角色检查中间件
- 定义权限常量（普通用户、管理员）
- 为需要管理员权限的接口添加中间件
- 处理权限不足的情况

**测试验证**：
- 创建管理员专用测试接口
- 使用管理员 Token 访问，确认成功
- 使用普通用户 Token 访问，确认返回 403
- 检查错误消息是否清晰

---

## 阶段五：普通用户模块 - 菜谱探索

### 步骤 5.1：实现菜谱列表接口

**操作指示**：
- 创建菜谱列表 API 端点（`GET /api/recipes`）
- 支持分页参数（page、page_size）
- 支持排序参数（按点击量、收藏量、创建时间）
- 支持筛选参数（菜系、难度、场景）
- 返回分页数据和分页信息

**测试验证**：
- 请求第一页数据，确认返回正确数量
- 请求不同页的数据，确认数据不同
- 使用菜系筛选，确认只返回该菜系的数据
- 使用排序参数，确认顺序正确
- 确认返回分页信息（总数、总页数）

---

### 步骤 5.2：实现菜谱搜索接口

**操作指示**：
- 创建菜谱搜索 API 端点（`GET /api/recipes/search`）
- 支持关键词搜索（搜索菜谱名称）
- 支持食材搜索
- 支持模糊匹配
- 返回匹配的菜谱列表
- 添加搜索性能优化（索引、缓存）

**测试验证**：
- 搜索已知菜谱名称，确认能找到
- 搜索食材名称，确认能找到相关菜谱
- 搜索不存在的关键词，确认返回空列表
- 测试搜索性能，确认响应时间 < 500ms

---

### 步骤 5.3：实现菜谱详情接口

**操作指示**：
- 创建菜谱详情 API 端点（`GET /api/recipes/:id`）
- 返回完整的菜谱信息：
  - 基本信息（名称、菜系、难度、时长）
  - 食材列表（含用量）
  - 详细步骤
  - 成品图片
  - 点击量和收藏量
- 记录浏览行为到行为日志表
- 增加点击量计数

**测试验证**：
- 请求存在的菜谱 ID，确认返回完整信息
- 请求不存在的菜谱 ID，确认返回 404
- 多次请求同一菜谱，确认点击量增加
- 检查行为日志，确认浏览行为被记录

---

### 步骤 5.4：实现分类列表接口

**操作指示**：
- 创建分类列表 API 端点（`GET /api/categories`）
- 支持按类型筛选（菜系、场景、人群、口味）
- 返回分类名称和 ID
- 按排序序号排列

**测试验证**：
- 请求所有菜系分类，确认返回八大菜系
- 请求场景分类，确认返回早餐、午餐等
- 确认返回顺序按排序序号排列

---

### 步骤 5.5：实现热门菜谱接口

**操作指示**：
- 创建热门菜谱 API 端点（`GET /api/recipes/hot`）
- 基于点击量或收藏量排序
- 返回 Top 20 或 50
- 可设置缓存（如 5 分钟）

**测试验证**：
- 请求热门菜谱，确认返回数据
- 确认按点击量或收藏量降序排列
- 多次请求，确认数据一致性（缓存生效）

---

### 步骤 5.6：实现食材列表接口

**操作指示**：
- 创建食材列表 API 端点（`GET /api/ingredients`）
- 支持按分类筛选
- 支持搜索食材名称
- 返回食材列表

**测试验证**：
- 请求所有食材，确认返回数据
- 按分类筛选，确认只返回该分类的食材
- 搜索食材名称，确认能找到匹配项

---

## 阶段六：普通用户模块 - 收藏功能

### 步骤 6.1：实现收藏菜谱接口

**操作指示**：
- 创建收藏 API 端点（`POST /api/favorites`）
- 使用身份验证中间件保护
- 接收菜谱 ID
- 检查菜谱是否存在
- 检查是否已收藏
- 创建收藏记录
- 增加菜谱的收藏量
- 记录收藏行为到行为日志表

**测试验证**：
- 使用有效 Token 收藏菜谱，确认成功
- 收藏同一菜谱两次，确认第二次失败
- 收藏不存在的菜谱，确认返回错误
- 检查收藏量是否增加
- 检查行为日志是否记录

---

### 步骤 6.2：实现取消收藏接口

**操作指示**：
- 创建取消收藏 API 端点（`DELETE /api/favorites/:recipeId`）
- 使用身份验证中间件保护
- 检查是否已收藏
- 删除收藏记录
- 减少菜谱的收藏量
- 返回成功信息

**测试验证**：
- 取消已收藏的菜谱，确认成功
- 取消未收藏的菜谱，确认返回错误
- 检查收藏量是否减少
- 再次查询收藏列表，确认菜谱已被移除

---

### 步骤 6.3：实现收藏列表接口

**操作指示**：
- 创建收藏列表 API 端点（`GET /api/favorites`）
- 使用身份验证中间件保护
- 支持分页
- 返回用户收藏的菜谱列表
- 包含收藏时间信息
- 支持按收藏时间排序

**测试验证**：
- 请求收藏列表，确认返回已收藏的菜谱
- 确认只返回当前用户的收藏
- 使用不同用户的 Token，确认返回不同的收藏
- 测试分页功能

---

### 步骤 6.4：实现检查收藏状态接口

**操作指示**：
- 创建检查收藏状态 API 端点（`GET /api/favorites/check/:recipeId`）
- 使用身份验证中间件保护
- 返回是否已收藏的布尔值

**测试验证**：
- 检查已收藏的菜谱，确认返回 true
- 检查未收藏的菜谱，确认返回 false
- 不使用 Token 访问，确认返回 401

---

## 阶段七：普通用户模块 - 数据展示（只读）

### 步骤 7.1：实现菜系分布分析接口

**操作指示**：
- 创建菜系分布分析 API 端点（`GET /api/analytics/cuisines`）
- 统计各菜系的菜谱数量
- 计算占比百分比
- 返回分类名称、数量、占比
- 添加缓存（如 10 分钟）

**测试验证**：
- 请求接口，确认返回各菜系数据
- 确认数量总和等于总菜谱数
- 确认占比总和等于 100%
- 检查缓存是否生效

---

### 步骤 7.2：实现难度等级统计接口

**操作指示**：
- 创建难度统计 API 端点（`GET /api/analytics/difficulty`）
- 统计各难度等级的菜谱数量
- 返回难度等级、数量、占比
- 添加缓存

**测试验证**：
- 请求接口，确认返回简单、中等、困难的数据
- 确认数据分布合理
- 检查缓存是否生效

---

### 步骤 7.3：实现口味偏好分析接口

**操作指示**：
- 创建口味分析 API 端点（`GET /api/analytics/flavors`）
- 统计各口味标签的菜谱数量
- 返回口味名称、数量
- 按数量降序排列
- 添加缓存

**测试验证**：
- 请求接口，确认返回口味数据
- 确认按数量降序排列
- 检查缓存是否生效

---

### 步骤 7.4：实现食材使用频率统计接口

**操作指示**：
- 创建食材频率分析 API 端点（`GET /api/analytics/ingredients`）
- 统计各食材被使用的菜谱数量
- 返回 Top 20 或 50 食材
- 返回食材名称、使用次数
- 按使用次数降序排列
- 添加缓存

**测试验证**：
- 请求接口，确认返回高频食材
- 确认按使用次数降序排列
- 检查缓存是否生效

---

## 阶段八：前端 - 用户认证页面
>  前端均使用 frontend-design skill来设计实现

### 步骤 8.1：创建登录页面

**操作指示**：
- 创建登录页面组件
- 设计登录表单：
  - 用户名输入框
  - 密码输入框
  - 记住我复选框
  - 登录按钮
  - 跳转注册链接
- 实现表单验证
- 连接登录 API
- 存储 Token 到本地存储
- 登录成功后跳转到首页
- 添加错误提示

**测试验证**：
- 打开登录页面，确认表单正常显示
- 输入空用户名密码，确认显示验证错误
- 输入错误密码，确认显示错误提示
- 输入正确信息，确认登录成功并跳转
- 刷新页面，确认保持登录状态
- 点击注册链接，确认跳转到注册页

---

### 步骤 8.2：创建注册页面

**操作指示**：
- 创建注册页面组件
- 设计注册表单：
  - 用户名输入框
  - 邮箱/手机号输入框
  - 密码输入框
  - 确认密码输入框
  - 注册按钮
  - 跳转登录链接
- 实现表单验证（密码强度、密码匹配）
- 连接注册 API
- 注册成功后跳转到登录页
- 添加错误提示

**测试验证**：
- 打开注册页面，确认表单正常显示
- 输入不匹配的密码，确认显示错误
- 输入弱密码，确认显示错误
- 使用已存在的用户名注册，确认显示错误
- 使用有效信息注册，确认成功并跳转

---

### 步骤 8.3：创建个人信息页面

**操作指示**：
- 创建个人信息页面组件
- 显示用户信息：
  - 用户名
  - 昵称
  - 个人简介
  - 注册时间
- 提供编辑按钮
- 创建编辑表单模态框或区域
- 实现更新信息功能
- 连接更新 API
- 添加成功提示

**测试验证**：
- 打开页面，确认显示当前用户信息
- 点击编辑，确认显示编辑表单
- 修改昵称并保存，确认更新成功
- 刷新页面，确认显示新昵称

---

### 步骤 8.4：创建修改密码页面

**操作指示**：
- 创建修改密码页面组件
- 设计修改密码表单：
  - 旧密码输入框
  - 新密码输入框
  - 确认新密码输入框
  - 提交按钮
- 实现表单验证
- 连接修改密码 API
- 成功后清除登录状态
- 跳转到登录页
- 添加提示信息

**测试验证**：
- 打开页面，确认表单正常显示
- 输入错误的旧密码，确认显示错误
- 输入不匹配的新密码，确认显示错误
- 输入正确信息，确认修改成功并跳转
- 使用新密码登录，确认成功

---

## 阶段九：前端 - 菜谱探索页面

### 步骤 9.1：创建菜谱列表页面

**操作指示**：
- 创建菜谱列表页面组件
- 设计页面布局：
  - 顶部搜索栏
  - 侧边栏筛选区（菜系、难度、场景）
  - 主内容区（菜谱卡片网格）
  - 分页组件
- 实现菜谱卡片：
  - 菜谱图片
  - 菜谱名称
  - 菜系标签
  - 难度标签
  - 点击量/收藏量显示
  - 收藏按钮
- 连接菜谱列表 API
- 实现筛选和分页功能
- 添加加载状态和错误处理

**测试验证**：
- 打开页面，确认显示菜谱列表
- 确认分页功能正常
- 使用筛选条件，确认结果正确
- 点击菜谱卡片，确认跳转到详情页
- 点击收藏按钮，确认收藏成功

---

### 步骤 9.2：创建菜谱详情页面

**操作指示**：
- 创建菜谱详情页面组件
- 设计页面布局：
  - 成品图片展示区
  - 菜谱基本信息（名称、菜系、难度、时长）
  - 食材列表
  - 详细步骤
  - 点击量/收藏量
  - 收藏按钮
  - 返回按钮
- 连接菜谱详情 API
- 实现收藏功能
- 处理菜谱不存在的情况
- 添加加载状态

**测试验证**：
- 从列表页点击菜谱，确认显示详情
- 确认所有信息完整显示
- 点击收藏按钮，确认收藏成功
- 确认点击量增加
- 访问不存在的菜谱 ID，确认显示 404

---

### 步骤 9.3：创建菜谱分类页面

**操作指示**：
- 创建菜谱分类页面组件
- 设计页面布局：
  - 分类标签列表（菜系、场景、人群）
  - 该分类下的菜谱列表
- 支持动态路由参数
- 连接菜谱列表 API（带分类筛选）
- 实现与列表页类似的卡片和分页

**测试验证**：
- 访问不同分类 URL，确认显示对应菜谱
- 确认只显示该分类的菜谱
- 测试分页功能
- 点击菜谱，确认跳转到详情页

---

### 步骤 9.4：创建热门菜谱页面

**操作指示**：
- 创建热门菜谱页面组件
- 设计页面布局：
  - 页面标题
  - Top 菜谱列表（使用卡片或排行榜样式）
- 连接热门菜谱 API
- 实现菜谱卡片
- 添加排序说明（按点击量/收藏量）

**测试验证**：
- 打开页面，确认显示热门菜谱
- 确认按热度排序
- 点击菜谱，确认跳转到详情页

---

### 步骤 9.5：实现搜索功能

**操作指示**：
- 在列表页添加搜索输入框
- 实现搜索输入处理
- 连接搜索 API
- 显示搜索结果
- 处理无结果的情况
- 添加搜索历史（可选）

**测试验证**：
- 输入搜索关键词，确认显示搜索结果
- 确认搜索结果与关键词相关
- 清空搜索，确认显示所有菜谱
- 搜索不存在的内容，确认显示无结果提示

---

## 阶段十：前端 - 收藏功能页面

### 步骤 10.1：创建我的收藏页面

**操作指示**：
- 创建我的收藏页面组件
- 设计页面布局：
  - 页面标题
  - 收藏的菜谱列表（使用卡片样式）
  - 空状态提示（无收藏时）
- 连接收藏列表 API
- 实现取消收藏功能
- 按收藏时间排序
- 添加分页

**测试验证**：
- 打开页面，确认显示收藏的菜谱
- 确认只显示当前用户的收藏
- 取消收藏，确认菜谱从列表中移除
- 确认取消后菜谱的收藏量减少

---

## 阶段十一：前端 - 数据展示页面（只读）

### 步骤 11.1：创建数据概览页面

**操作指示**：
- 创建数据概览页面组件
- 设计页面布局：
  - 页面标题
  - 数据卡片网格（菜系分布、难度分布、口味统计、食材频率）
- 集成 ECharts 或 AntV
- 连接数据统计 API
- 创建以下图表：
  - 菜系分布饼图
  - 难度等级柱状图
  - 口味偏好雷达图
- 添加图表交互（点击、悬停）

**测试验证**：
- 打开页面，确认所有图表正常显示
- 确认图表数据与 API 返回一致
- 测试图表交互功能
- 确认图表响应式布局

---

### 步骤 11.2：创建食材频率页面

**操作指示**：
- 创建食材频率页面组件
- 设计页面布局：
  - 页面标题
  - 食材词云或 Top 列表
- 连接食材频率 API
- 实现词云图或排行榜展示
- 按使用频率排序

**测试验证**：
- 打开页面，确认显示高频食材
- 确认按使用频率排序
- 测试词云交互（如悬停显示次数）

---

## 阶段十二：管理员模块 - 用户管理

### 步骤 12.1：实现用户列表接口

**操作指示**：
- 创建用户列表 API 端点（`GET /api/admin/users`）
- 使用管理员权限中间件保护
- 支持分页
- 支持搜索（用户名、邮箱）
- 支持按角色筛选
- 返回用户基本信息（不含密码）

**测试验证**：
- 使用管理员 Token 访问，确认返回用户列表
- 使用普通用户 Token 访问，确认返回 403
- 测试分页功能
- 测试搜索功能

---

### 步骤 12.2：实现封禁/解封用户接口

**操作指示**：
- 创建封禁用户 API 端点（`PUT /api/admin/users/:id/ban`）
- 创建解封用户 API 端点（`PUT /api/admin/users/:id/unban`）
- 使用管理员权限中间件保护
- 防止封禁自己
- 更新用户状态
- 返回更新后的用户信息

**测试验证**：
- 使用管理员 Token 封禁用户，确认成功
- 被封禁用户尝试登录，确认失败
- 解封用户，确认可以重新登录
- 尝试封禁自己，确认失败

---

### 步骤 12.3：创建用户管理页面

**操作指示**：
- 创建用户管理页面组件
- 设计页面布局：
  - 用户搜索栏
  - 用户列表表格（用户名、邮箱、角色、状态、操作）
  - 分页组件
- 连接用户列表 API
- 实现封禁/解封按钮
- 添加管理员路由守卫（非管理员无法访问）

**测试验证**：
- 使用管理员账号登录，访问页面，确认显示用户列表
- 使用普通用户账号访问，确认跳转或显示权限不足
- 封禁用户，确认操作成功
- 解封用户，确认操作成功

---

## 阶段十三：管理员模块 - 菜谱管理

### 步骤 13.1：实现菜谱管理列表接口

**操作指示**：
- 创建菜谱管理列表 API 端点（`GET /api/admin/recipes`）
- 使用管理员权限中间件保护
- 支持分页
- 支持搜索
- 支持按所有字段筛选
- 返回菜谱简要信息

**测试验证**：
- 使用管理员 Token 访问，确认返回菜谱列表
- 测试分页和筛选功能

---

### 步骤 13.2：实现创建菜谱接口

**操作指示**：
- 创建菜谱 API 端点（`POST /api/admin/recipes`）
- 使用管理员权限中间件保护
- 验证必填字段
- 处理图片上传
- 处理食材关联
- 创建菜谱记录
- 返回创建的菜谱信息

**测试验证**：
- 使用有效数据创建菜谱，确认成功
- 使用缺少必填字段的数据创建，确认失败
- 检查数据库，确认菜谱已创建
- 检查食材关联是否正确

---

### 步骤 13.3：实现更新菜谱接口

**操作指示**：
- 创建更新菜谱 API 端点（`PUT /api/admin/recipes/:id`）
- 使用管理员权限中间件保护
- 验证输入数据
- 更新菜谱信息
- 处理食材关联更新
- 返回更新后的菜谱信息

**测试验证**：
- 更新存在的菜谱，确认成功
- 更新不存在的菜谱，确认返回 404
- 检查数据库，确认数据已更新

---

### 步骤 13.4：实现删除菜谱接口

**操作指示**：
- 创建删除菜谱 API 端点（`DELETE /api/admin/recipes/:id`）
- 使用管理员权限中间件保护
- 检查菜谱是否存在
- 删除菜谱记录
- 删除相关收藏记录
- 删除食材关联
- 返回成功信息

**测试验证**：
- 删除存在的菜谱，确认成功
- 删除不存在的菜谱，确认返回 404
- 检查数据库，确认菜谱已删除
- 检查收藏记录是否已清理

---

### 步骤 13.5：实现批量导入菜谱接口

**操作指示**：
- 创建批量导入 API 端点（`POST /api/admin/recipes/import`）
- 使用管理员权限中间件保护
- 支持 CSV 或 JSON 文件上传
- 验证文件格式
- 解析文件内容
- 批量插入数据库
- 返回导入结果（成功数、失败数）

**测试验证**：
- 上传有效的 CSV/JSON 文件，确认导入成功
- 上传格式错误的文件，确认返回错误
- 检查导入的数据量是否正确
- 检查失败记录的错误信息

---

### 步骤 13.6：创建菜谱管理页面

**操作指示**：
- 创建菜谱管理页面组件
- 设计页面布局：
  - 操作按钮区（新增、批量导入）
  - 搜索和筛选区
  - 菜谱列表表格
  - 分页组件
- 创建新增/编辑菜谱表单模态框
- 连接菜谱管理 API
- 实现所有 CRUD 操作
- 添加确认提示（删除操作）
- 添加成功/失败提示

**测试验证**：
- 打开页面，确认显示菜谱列表
- 点击新增，确认显示表单
- 提交有效数据，确认创建成功
- 编辑菜谱，确认更新成功
- 删除菜谱，确认删除成功
- 测试批量导入功能

---

## 阶段十四：管理员模块 - 分类与食材管理

### 步骤 14.1：实现分类管理接口

**操作指示**：
- 创建分类 CRUD API 端点
- 使用管理员权限中间件保护
- 支持创建、读取、更新、删除分类
- 支持调整排序序号

**测试验证**：
- 创建新分类，确认成功
- 更新分类，确认成功
- 删除分类，确认成功
- 检查排序功能

---

### 步骤 14.2：实现食材管理接口

**操作指示**：
- 创建食材 CRUD API 端点
- 使用管理员权限中间件保护
- 支持创建、读取、更新、删除食材
- 支持按分类查询

**测试验证**：
- 创建新食材，确认成功
- 更新食材，确认成功
- 删除食材，确认成功
- 测试分类查询

---

### 步骤 14.3：创建分类管理页面

**操作指示**：
- 创建分类管理页面组件
- 设计页面布局：
  - 分类类型切换标签
  - 分类列表
  - 新增/编辑表单
- 连接分类管理 API
- 实现拖拽排序（可选）

**测试验证**：
- 打开页面，确认显示分类列表
- 创建新分类，确认成功
- 编辑分类，确认成功
- 删除分类，确认成功

---

### 步骤 14.4：创建食材管理页面

**操作指示**：
- 创建食材管理页面组件
- 设计页面布局：
  - 搜索栏
  - 食材列表
  - 新增/编辑表单
- 连接食材管理 API
- 支持按分类筛选

**测试验证**：
- 打开页面，确认显示食材列表
- 创建新食材，确认成功
- 编辑食材，确认成功
- 删除食材，确认成功

---

## 阶段十五：管理员模块 - 数据分析

### 步骤 15.1：实现菜系分析接口（管理员）

**操作指示**：
- 创建菜系深度分析 API 端点（`GET /api/admin/analytics/cuisines`）
- 使用管理员权限中间件保护
- 返回详细分析数据：
  - 各菜系数量和占比
  - 各菜系的平均点击量
  - 各菜系的平均收藏量
  - 各菜系的难度分布

**测试验证**：
- 使用管理员 Token 访问，确认返回详细数据
- 确认数据维度完整
- 验证数据准确性

---

### 步骤 15.2：实现难度分析接口（管理员）

**操作指示**：
- 创建难度分析 API 端点（`GET /api/admin/analytics/difficulty`）
- 使用管理员权限中间件保护
- 返回详细分析数据：
  - 各难度等级数量和占比
  - 各难度等级的平均烹饪时长
  - 各难度等级的平均点击量

**测试验证**：
- 使用管理员 Token 访问，确认返回详细数据
- 验证数据准确性

---

### 步骤 15.3：实现热门菜谱分析接口

**操作指示**：
- 创建热门菜谱分析 API 端点（`GET /api/admin/analytics/hot`）
- 使用管理员权限中间件保护
- 返回详细分析数据：
  - Top 菜谱列表
  - 点击量趋势
  - 收藏量趋势
  - 收藏转化率（收藏量/点击量）

**测试验证**：
- 使用管理员 Token 访问，确认返回详细数据
- 验证转化率计算正确

---

### 步骤 15.4：实现食材关联分析接口

**操作指示**：
- 创建食材关联分析 API 端点（`GET /api/admin/analytics/ingredient-pairs`）
- 使用管理员权限中间件保护
- 分析食材共现频率
- 返回常见食材搭配组合
- 返回搭配频率统计

**测试验证**：
- 使用管理员 Token 访问，确认返回食材搭配数据
- 验证搭配频率统计正确

---

### 步骤 15.5：创建数据分析页面

**操作指示**：
- 创建数据分析页面组件
- 设计页面布局：
  - 分析维度切换标签（菜系、难度、热门、食材）
  - 图表展示区
  - 数据表格区
- 连接分析 API
- 创建多个交互图表
- 添加时间范围筛选器
- 支持数据导出

**测试验证**：
- 打开页面，确认显示所有分析维度
- 切换标签，确认显示对应分析
- 测试时间范围筛选
- 测试数据导出功能

---

## 阶段十六：管理员模块 - 数据可视化仪表盘

### 步骤 16.1：实现数据总览接口

**操作指示**：
- 创建数据总览 API 端点（`GET /api/admin/dashboard/overview`）
- 使用管理员权限中间件保护
- 返回关键指标：
  - 总菜谱数
  - 总用户数
  - 今日新增菜谱数
  - 今日新增用户数
  - 今日活跃用户数
  - 总收藏数
- 添加缓存（如 5 分钟）

**测试验证**：
- 使用管理员 Token 访问，确认返回所有指标
- 验证指标数值正确
- 检查缓存是否生效

---

### 步骤 16.2：实现数据趋势接口

**操作指示**：
- 创建数据趋势 API 端点（`GET /api/admin/dashboard/trends`）
- 使用管理员权限中间件保护
- 支持时间范围参数（日、周、月）
- 返回趋势数据：
  - 菜谱增长趋势
  - 用户增长趋势
  - 收藏趋势
- 添加缓存

**测试验证**：
- 请求日趋势数据，确认返回每日数据
- 请求周趋势数据，确认返回每周数据
- 验证数据点数量正确

---

### 步骤 16.3：实现用户行为统计接口

**操作指示**：
- 创建用户行为统计 API 端点（`GET /api/admin/dashboard/behaviors`）
- 使用管理员权限中间件保护
- 统计各类行为数量
- 统计活跃用户分布
- 统计页面访问量
- 返回行为分布数据

**测试验证**：
- 使用管理员 Token 访问，确认返回行为统计
- 验证各类行为数量正确
- 检查活跃用户统计

---

### 步骤 16.4：创建数据总览仪表盘页面

**操作指示**：
- 创建数据总览仪表盘页面组件
- 设计页面布局：
  - 顶部关键指标卡片（4-6 个）
  - 趋势图表区
  - 用户行为分析区
- 集成 ECharts/AntV
- 连接仪表盘 API
- 创建折线图显示趋势
- 创建饼图显示行为分布
- 添加数据刷新功能
- 添加时间范围选择器

**测试验证**：
- 打开页面，确认所有指标卡片正常显示
- 确认趋势图正常渲染
- 切换时间范围，确认图表更新
- 测试数据刷新功能

---

## 阶段十七：用户行为数据模拟

### 步骤 17.1：创建模拟用户脚本

**操作指示**：
- 创建模拟用户生成脚本
- 生成 100+ 模拟用户账号
- 用户信息包括：
  - 用户名
  - 密码
  - 邮箱
  - 昵称
- 将用户数据插入数据库
- 记录生成的用户 ID

**测试验证**：
- 运行脚本
- 检查数据库，确认用户已创建
- 确认用户数量符合预期
- 随机抽取用户尝试登录，确认可以登录

---

### 步骤 17.2：创建行为模拟脚本

**操作指示**：
- 创建行为模拟脚本
- 定义行为类型：
  - 登录
  - 搜索（随机菜谱名称或食材）
  - 浏览菜谱（随机访问菜谱详情）
  - 收藏菜谱（随机收藏）
- 设置行为时间分布：
  - 过去 30 天内
  - 模拟真实用户行为模式（如白天活跃度高于夜间）
- 为每个模拟用户生成 20-100 条行为记录
- 插入行为日志表
- 根据行为更新菜谱点击量和收藏量

**测试验证**：
- 运行脚本
- 检查行为日志表，确认记录已生成
- 检查菜谱点击量和收藏量，确认已更新
- 检查行为时间分布，确认符合预期
- 验证数据合理性（如收藏量不应超过点击量）

---

### 步骤 17.3：创建页面访问模拟脚本

**操作指示**：
- 创建页面访问模拟脚本
- 模拟用户访问各个页面：
  - 首页
  - 菜谱列表页
  - 菜谱详情页
  - 分类页
  - 热门页
- 计算页面停留时间
- 记录访问路径（模拟点击流）
- 插入行为日志表

**测试验证**：
- 运行脚本
- 检查访问记录，确认各页面都有访问
- 检查停留时间，确认合理
- 验证访问路径记录

---

### 步骤 17.4：验证模拟数据质量

**操作指示**：
- 编写数据质量验证脚本
- 检查以下内容：
  - 行为记录数量是否符合预期
  - 行为时间分布是否合理
  - 点击量和收藏量是否更新
  - 是否存在异常数据
- 生成数据质量报告

**测试验证**：
- 运行验证脚本
- 查看数据质量报告
- 修复发现的问题
- 重新验证直到数据质量合格

---

## 阶段十八：用户行为分析与可视化

### 步骤 18.1：实现点击流分析接口

**操作指示**：
- 创建点击流分析 API 端点（`GET /api/admin/analytics/clickstream`）
- 使用管理员权限中间件保护
- 分析用户访问路径
- 统计常见路径模式
- 计算转化率（浏览到收藏）
- 返回路径分布数据

**测试验证**：
- 使用管理员 Token 访问，确认返回点击流数据
- 验证路径分析正确
- 验证转化率计算正确

---

### 步骤 18.2：实现活跃用户分析接口

**操作指示**：
- 创建活跃用户分析 API 端点（`GET /api/admin/analytics/active-users`）
- 使用管理员权限 中间件保护
- 统计日活跃用户（DAU）
- 统计周活跃用户（WAU）
- 统计月活跃用户（MAU）
- 返回活跃用户趋势

**测试验证**：
- 使用管理员 Token 访问，确认返回活跃用户数据
- 验证 DAU/WAU/MAU 计算正确

---

### 步骤 18.3：实现登录频次分析接口

**操作指示**：
- 创建登录频次分析 API 端点（`GET /api/admin/analytics/login-frequency`）
- 使用管理员权限中间件保护
- 统计用户登录次数分布
- 统计登录时间段分布
- 返回登录频次数据

**测试验证**：
- 使用管理员 Token 访问，确认返回登录频次数据
- 验证时间段分布统计正确

---

### 步骤 18.4：实现页面停留分析接口

**操作指示**：
- 创建页面停留分析 API 端点（`GET /api/admin/analytics/page-duration`）
- 使用管理员权限中间件保护
- 统计各页面平均停留时间
- 统计停留时长分布
- 返回停留分析数据

**测试验证**：
- 使用管理员 Token 访问，确认返回停留数据
- 验证平均停留时间计算正确

---

### 步骤 18.5：创建用户行为分析页面

**操作指示**：
- 创建用户行为分析页面组件
- 设计页面布局：
  - 分析维度切换标签
  - 图表展示区
  - 数据表格区
- 连接行为分析 API
- 创建以下可视化：
  - 点击流桑基图或路径图
  - 活跃用户趋势折线图
  - 登录频次柱状图
  - 页面停留时长热力图
- 支持时间范围筛选
- 支持数据导出

**测试验证**：
- 打开页面，确认显示所有分析维度
- 确认所有图表正常渲染
- 切换时间范围，确认图表更新
- 测试数据导出功能

---

## 阶段十九：前端优化与完善

### 步骤 19.1：优化首页

**操作指示**：
- 设计首页布局：
  - 顶部导航栏
  - 搜索框
  - 热门菜谱展示区
  - 分类快捷入口
  - 数据概览卡片（只读）
- 实现响应式布局
- 添加加载骨架屏
- 优化图片加载（懒加载）

**测试验证**：
- 打开首页，确认布局美观
- 测试响应式布局（不同屏幕尺寸）
- 测试搜索功能
- 测试快捷入口跳转

---

### 步骤 19.2：实现全局导航

**操作指示**：
- 创建导航栏组件
- 根据用户角色显示不同菜单：
  - 未登录：首页、登录、注册
  - 普通用户：首页、菜谱、收藏、数据、个人中心
  - 管理员：首页、菜谱、用户管理、数据分析、数据大盘
- 实现路由跳转
- 添加用户头像和下拉菜单
- 实现退出登录功能

**测试验证**：
- 未登录状态，确认显示基础菜单
- 登录普通用户账号，确认显示用户菜单
- 登录管理员账号，确认显示管理员菜单
- 点击菜单项，确认正确跳转
- 点击退出登录，确认清除状态并跳转

---

### 步骤 19.3：优化错误处理

**操作指示**：
- 创建全局错误处理中间件
- 创建错误提示组件
- 处理常见错误类型：
  - 401 未授权
  - 403 权限不足
  - 404 资源不存在
  - 500 服务器错误
- 添加友好的错误提示
- 添加重试功能（如适用）

**测试验证**：
- 触发各种错误场景，确认显示友好提示
- 测试重试功能
- 确认错误不会导致页面崩溃

---

### 步骤 19.4：优化加载状态

**操作指示**：
- 创建加载组件
- 为所有异步操作添加加载状态：
  - API 请求
  - 页面切换
  - 数据提交
- 添加骨架屏（列表页）
- 添加进度条（上传操作）

**测试验证**：
- 打开各页面，确认加载状态正常显示
- 测试慢网络下的加载体验
- 确认加载完成后数据正确显示

---

### 步骤 19.5：实现响应式布局

**操作指示**：
- 检查所有页面
- 适配移动端布局：
  - 导航栏适配
  - 表格适配（使用卡片替代）
  - 图表适配
  - 表单适配
- 测试常见屏幕尺寸：
  - 手机（375px、414px）
  - 平板（768px、1024px）
  - 桌面（1440px、1920px）

**测试验证**：
- 在不同屏幕尺寸下测试所有页面
- 确认布局无错乱
- 确认交互功能正常

---

## 阶段二十：性能优化与部署准备

### 步骤 20.1：优化查询性能（不使用缓存）

**操作指示**：
- ⚠️ **当前阶段不使用 Redis 缓存**
- 优化数据库查询语句，减少不必要的数据获取
- 使用数据库 `select_related` 和 `prefetch_related` 优化关联查询
- 为统计 API 添加适当的数据库索引
- 对统计数据进行预计算或视图优化
- 使用数据库分页避免大数据量查询

**测试验证**：
- 测试各 API 接口响应时间
- 确认统计 API 在无缓存情况下仍能满足性能要求
- 使用数据库 EXPLAIN 分析查询计划
- 确认索引正确使用

---

### 步骤 20.2：优化数据库查询

**操作指示**：
- 分析慢查询
- 为常用查询字段添加索引：
  - 菜谱表的菜系、难度字段
  - 行为日志表的用户 ID、行为类型、时间字段
- 优化 N+1 查询
- 使用查询优化工具分析

**测试验证**：
- 运行查询分析工具
- 确认无慢查询
- 测试大数据量下的查询性能

---

### 步骤 20.3：优化图片加载

**操作指示**：
- 实现图片懒加载
- 添加图片缩略图
- 使用 CDN 加速（可选）
- 添加图片加载占位符
- 处理图片加载失败

**测试验证**：
- 滚动页面，确认图片懒加载生效
- 测试慢网络下的图片加载
- 测试图片加载失败的处理

---

### 步骤 20.4：实现前端代码分割

**操作指示**：
- 配置路由级别的代码分割
- 按需加载第三方库
- 优化打包体积
- 启用 Gzip 压缩

**测试验证**：
- 构建项目
- 检查打包产物大小
- 测试首次加载时间
- 测试路由切换性能

---

### 步骤 20.5：编写部署文档

**操作指示**：
- 编写部署文档，包含：
  - 环境要求
  - 依赖安装步骤
  - 数据库初始化
  - 环境变量配置
  - 前端构建部署
  - 后端服务部署
  - 常见问题处理

**测试验证**：
- 按照文档步骤，在全新环境中部署
- 确认文档步骤完整且正确
- 修正文档中的错误或遗漏

---

## 阶段二十一：最终测试与验收

### 步骤 21.1：功能完整性测试

**操作指示**：
- 列出所有功能清单
- 逐项测试每个功能：
  - 普通用户模块的所有页面和功能
  - 管理员模块的所有页面和功能
- 记录发现的问题
- 修复所有问题

**测试验证**：
- 确认所有功能正常工作
- 确认无明显的 Bug
- 确认用户体验流畅

---

### 步骤 21.2：数据验证测试

**操作指示**：
- 验证数据量：
  - 菜谱数据达到 10,000-20,000 条
  - 用户数据包含模拟用户
  - 行为数据充足
- 验证数据质量：
  - 无重复数据
  - 无异常数据
  - 关联关系正确
- 验证统计数据准确性

**测试验证**：
- 查询数据库，确认数据量达标
- 随机抽取数据检查质量
- 对比统计结果与原始数据

---

### 步骤 21.3：性能压力测试

**操作指示**：
- 使用压力测试工具（如 JMeter、k6）
- 测试场景：
  - 并发搜索
  - 并发浏览详情
  - 并发收藏
- 记录响应时间
- 优化性能瓶颈

**测试验证**：
- 确认搜索响应时间 < 500ms
- 确认详情页加载时间 < 1s
- 确认系统无崩溃
- 确认无明显性能瓶颈

---

### 步骤 21.4：数据可视化效果验收

**操作指示**：
- 检查所有数据可视化页面：
  - 普通用户的数据概览页面
  - 管理员的数据分析页面
  - 管理员的数据总览仪表盘
  - 管理员的用户行为分析页面
- 验证图表美观性和交互性
- 验证数据准确性
- 验证分析深度

**测试验证**：
- 确认所有图表正常渲染
- 确认图表交互流畅
- 确认数据标签清晰
- 确认分析有深度（不仅是基础统计）

---

### 步骤 21.5：用户行为模拟数据验收

**操作指示**：
- 检查用户行为统计页面
- 验证模拟行为数据的真实性：
  - 登录频次分布合理
  - 页面停留时间合理
  - 点击流路径合理
  - 转化率数据合理
- 验证分析结果的有效性

**测试验证**：
- 打开用户行为分析页面
- 确认数据分布真实可信
- 确认分析有洞察价值

---

### 步骤 21.6：跨浏览器测试

**操作指示**：
- 在主流浏览器中测试：
  - Chrome
  - Firefox
  - Safari
  - Edge
- 测试核心功能
- 修复兼容性问题

**测试验证**：
- 确认所有浏览器中功能正常
- 确认样式表现一致

---

### 步骤 21.7：安全检查

**操作指示**：
- 检查安全相关问题：
  - SQL 注入防护
  - XSS 防护
  - CSRF 防护
  - 权限验证
  - 敏感信息保护
- 修复发现的安全问题

**测试验证**：
- 尝试常见攻击方式
- 确认被正确防护
- 确认管理员权限严格控制

---

## 阶段二十二：项目交付

### 步骤 22.1：编写用户手册

**操作指示**：
- 编写普通用户使用手册
- 编写管理员使用手册
- 包含功能说明和操作步骤
- 添加截图示例

**测试验证**：
- 按照手册操作，确认步骤正确
- 确认手册易于理解

---

### 步骤 22.2：准备项目演示

**操作指示**：
- 准备演示脚本
- 准备演示数据
- 准备演示环境
- 测试演示流程

**测试验证**：
- 完整运行演示流程
- 确认无卡顿或错误

---

### 步骤 22.3：最终验收确认

**操作指示**：
- 对照 PRD 核对所有功能
- 确认数据量达标
- 确认数据可视化质量
- 确认用户行为模拟完整
- 确认系统性能达标
- 记录验收结果

**测试验证**：
- 逐项核对 PRD 要求
- 确认所有核心需求已满足

---

## 附录

### A. 技术栈参考（已确认）

| 类别 | 技术选择 |
|:---|:---|
| 前端框架 | Vue 3 (Composition API) |
| UI 框架 | Element Plus + Tailwind CSS |
| 图表库 | ECharts |
| 后端框架 | Django 5.2 + DRF |
| 数据库 | MySQL 8.0+ |
| 数据处理 | Pandas + NumPy |
| 认证 | JWT |
| ⚠️ 缓存 | **当前阶段不使用** |

### B. 数据规模目标

| 数据类型 | 目标数量 |
|:---|:---|
| 菜谱数据 | 10,000 - 20,000 条 |
| 模拟用户 | 100+ 个 |
| 用户行为记录 | 10,000+ 条 |
| 食材数据 | 500+ 种 |
| 分类数据 | 50+ 个 |

### C. 性能指标

| 指标 | 目标值 |
|:---|:---|
| 搜索响应时间 | < 500ms |
| 详情页加载时间 | < 1s |
| 大盘数据加载时间 | < 2s |
| 并发用户支持 | 100+ |

### D. 页面清单（按 PRD 编号）

**普通用户模块**：
1. 注册、登录、个人信息、密码管理
2. 菜谱查询、菜谱详情、分类浏览、热门菜谱
3. 菜谱收藏、收藏列表
4. 菜系分布、难度统计、口味偏好、食材频率

**管理员模块**：
1. 用户管理、角色权限、密码管理
2. 菜谱管理、分类管理、食材管理
3. 菜系分析、难度分析、口味分析、热门分析、食材分析
4. 数据总览仪表盘、数据趋势、用户行为统计

---

**实施计划完成**
