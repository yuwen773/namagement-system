# 食堂管理系统 - 实施计划

> 本文档为 AI 开发者提供详细的逐步实施说明
>
> **重要原则**：
> - 每个步骤必须小而具体，可独立完成和验证
> - 每个步骤完成后必须进行测试验证
> - 所有 UI 设计必须体现"食堂"行业元素
> - 开发阶段密码采用明文存储
> - 数据库使用 Django migrations（不直接执行 SQL 文件），表结构参考 init_db.sql
> - 前端采用响应式设计，PC 端优先（管理端和员工端均为 PC 端）

## 核心业务规则

### 薪资计算规则
| 项目 | 计算公式 |
|------|---------|
| **日工资** | 月薪 ÷ 21.75 天 |
| **时薪** | 日工资 ÷ 8 小时 |
| **加班费** | 时薪 × 1.5 × 加班小时数 |
| **迟到扣款** | 20 元/次 |
| **缺卡扣款** | 50 元/次（无签到或签退记录） |
| **岗位津贴** | 每个岗位固定金额（由管理员设置） |
| **实发工资** | 基本工资 + 岗位津贴 + 加班费 - 扣款 |

### 考勤判断规则
| 项目 | 规则 |
|------|------|
| **弹性时间** | 允许班次开始时间后 5 分钟内签到不算迟到 |
| **迟到判断** | 签到时间 > 班次开始时间 + 5 分钟 |
| **早退判断** | 签退时间 < 班次结束时间 - 5 分钟 |
| **缺卡判断** | 当天无签到或无签退记录 |
| **规则配置** | 以上阈值可在系统管理中修改 |

### UI 主题配色
| 用途 | 色值 |
|------|------|
| 主色 | 橙色 `#FF6B35` |
| 辅助色 | 黄色 `#F7C52D`、绿色 `#4CAF50` |
| 背景色 | 浅米色 `#FFF8F0` |
| 文字色 | 深灰 `#333333` |
| 图标 | 餐具、厨师帽、食材等食堂元素 |

---

## 第一阶段：环境搭建与项目初始化

### 步骤 1.1：创建后端 Django 项目

**实施指示**：
1. 在项目根目录下创建 `backend` 文件夹
2. 在 `backend` 文件夹内创建 Django 项目，项目名为 `config`
3. 创建以下 Django 应用：
   - `accounts` - 用户账号与认证
   - `employees` - 员工档案管理
   - `schedules` - 排班管理
   - `attendance` - 考勤管理
   - `leaves` - 请假管理
   - `salaries` - 薪资管理
   - `statistics` - 统计分析
4. 创建 `requirements.txt` 文件，包含以下依赖：
   - django>=5.2
   - djangorestframework
   - mysqlclient
   - django-cors-headers
5. 配置 `settings.py`：
   - 数据库连接到 MySQL 的 `canteen_management` 数据库
   - 添加 `rest_framework` 和 `corsheaders` 到 `INSTALLED_APPS`
   - 配置 CORS 允许前端跨域访问
   - 设置媒体文件和静态文件路径
   - **重要**：使用 Django migrations 管理数据库，表结构参考 `init_db.sql`，但不要直接执行 SQL 文件

**测试验证**：
1. 运行 `python manage.py runserver`，确认服务器启动无错误
2. 运行 `python manage.py makemigrations` 和 `python manage.py migrate`，确认创建所有表结构
3. 运行 `python manage.py showmigrations`，确认所有应用都已迁移
4. 访问 http://127.0.0.1:8000/，看到 Django 欢迎页面

---

### 步骤 1.2：创建前端 Vue 项目

**实施指示**：
1. 在项目根目录下创建 `frontend` 文件夹
2. 在 `frontend` 文件夹内初始化 Vue 3 + Vite 项目
3. 安装以下依赖：
   - element-plus
   - echarts
   - axios
   - vue-router
   - pinia
4. 配置 `vite.config.js`：
   - 设置开发服务器代理，将 `/api` 请求代理到后端 http://127.0.0.1:8000/api/
5. 创建以下目录结构：
   - `src/views/admin/` - 管理员端页面
   - `src/views/employee/` - 员工端页面
   - `src/views/auth/` - 认证相关页面
   - `src/components/` - 公共组件
   - `src/api/` - API 请求封装
   - `src/router/` - 路由配置
   - `src/stores/` - Pinia 状态管理

**测试验证**：
1. 运行 `npm run dev`，确认开发服务器启动
2. 访问开发服务器地址，看到 Vue 欢迎页面
3. 修改 `App.vue` 添加测试文字，确认热更新正常

---

## 第二阶段：后端核心模型与 API 基础

### 步骤 2.1：创建用户账号模型与 API

**实施指示**：
1. 在 `accounts/models.py` 中创建 `User` 模型，字段包括：
   - username (唯一)
   - password (明文存储)
   - employee_id (外键，可为空，关联员工档案)
   - role (枚举：ADMIN, EMPLOYEE)
   - status (枚举：ENABLED, DISABLED)
   - created_at, updated_at
2. 创建 `accounts/serializers.py`，定义序列化器：
   - 用户登录序列化器（username, password）
   - 用户注册序列化器（username, password, phone, email）
   - 用户详情序列化器
3. 创建 `accounts/views.py`，实现视图集：
   - 登录接口：验证账号密码，返回用户信息和 token
   - 注册接口：创建新用户，默认角色为 EMPLOYEE
   - 用户列表接口（仅管理员）
   - 用户详情/更新/删除接口
4. 配置 URL 路由

**测试验证**：
1. 使用 Postman 或 curl 测试注册接口：
   - POST /api/accounts/register/ 提交用户数据，返回成功
2. 测试登录接口：
   - POST /api/accounts/login/ 提交账号密码，返回用户信息和角色
3. 测试用户列表接口（需先登录管理员账号）：
   - GET /api/accounts/users/ 返回用户列表

---

### 步骤 2.2：创建员工档案模型与 API

**实施指示**：
1. 在 `employees/models.py` 中创建 `EmployeeProfile` 模型，字段包括：
   - name
   - gender (枚举：MALE, FEMALE)
   - phone
   - id_card (唯一)
   - address
   - position (枚举：CHEF, PASTRY, PREP, CLEANER, SERVER, MANAGER)
   - entry_date
   - status (枚举：ACTIVE, INACTIVE, LEAVE_WITHOUT_PAY)
   - health_certificate_no
   - health_certificate_expiry
   - health_certificate_url
   - chef_certificate_level
   - created_at, updated_at
2. 创建序列化器和视图集，支持 CRUD 操作
3. 添加筛选功能：按姓名、岗位、状态筛选
4. 配置 URL 路由

**测试验证**：
1. 创建新员工档案，确认所有字段保存成功
2. 测试筛选功能：按岗位筛选，返回正确的员工列表
3. 测试更新和删除功能

---

### 步骤 2.3：创建排班相关模型与 API

**实施指示**：
1. 在 `schedules/models.py` 中创建模型：
   - `Shift` 模型：班次定义（name, start_time, end_time）
   - `Schedule` 模型：排班计划（employee, shift, work_date, is_swapped）
   - `ShiftSwapRequest` 模型：调班申请（requester, original_schedule, target_date, target_shift, reason, status, approver, approval_remark）
2. 创建序列化器和视图集
3. 实现特殊接口：
   - 日历视图接口：返回指定日期范围的排班数据
   - 批量排班接口：一次为多个员工创建排班
   - 调班审核接口：批准或拒绝调班申请
4. 配置 URL 路由

**测试验证**：
1. 创建多个班次（早餐班、中餐班等）
2. 为员工创建排班计划
3. 提交调班申请，使用管理员账号审核，确认排班自动更新
4. 测试日历视图接口，确认返回正确的排班数据

---

### 步骤 2.4：创建考勤模型与 API

**实施指示**：
1. 在 `attendance/models.py` 中创建 `AttendanceRecord` 模型：
   - employee
   - schedule (外键，可为空)
   - clock_in_time
   - clock_out_time
   - clock_in_location
   - clock_out_location
   - status (枚举：NORMAL, LATE, EARLY_LEAVE, MISSING, ABNORMAL)
   - correction_remark
2. 创建序列化器和视图集
3. 实现接口：
   - 签到接口：记录签到时间和地点，自动判断考勤状态
   - 签退接口：记录签退时间和地点，自动判断考勤状态
   - 考勤统计接口：汇总迟到次数、缺卡次数、加班时长
   - 异常处理接口：管理员可修改考勤状态并填写备注
4. **考勤状态判断逻辑**：
   - 签到时间 ≤ 班次开始时间 + 5 分钟 → NORMAL
   - 签到时间 > 班次开始时间 + 5 分钟 → LATE（迟到）
   - 签退时间 < 班次结束时间 - 5 分钟 → EARLY_LEAVE（早退）
   - 无签到记录或无签退记录 → MISSING（缺卡）
   - 加班计算：签退时间 > 班次结束时间，计算加班小时数
5. 配置 URL 路由

**测试验证**：
1. 员工在班次开始时间前 5 分钟内签到，确认状态为 NORMAL
2. 员工在班次开始时间后 6 分钟签到，确认状态为 LATE
3. 员工提前签退超过 5 分钟，确认状态为 EARLY_LEAVE
4. 员工只有签到没有签退，确认状态为 MISSING
5. 员工签退时间超过班次结束时间，确认计算了加班时长
6. 管理员修改异常考勤，确认状态更新且有备注

---

### 步骤 2.5：创建请假模型与 API

**实施指示**：
1. 在 `leaves/models.py` 中创建 `LeaveRequest` 模型：
   - employee
   - leave_type (枚举：SICK, PERSONAL, COMPENSATORY)
   - start_time
   - end_time
   - reason
   - status (枚举：PENDING, APPROVED, REJECTED)
   - approver
   - approval_remark
2. 创建序列化器和视图集
3. 实现接口：
   - 提交请假申请接口
   - 审批接口（批准/拒绝，填写意见）
   - 我的请假记录接口
   - 待审批列表接口（管理员）
4. 配置 URL 路由

**测试验证**：
1. 员工提交请假申请，确认状态为 PENDING
2. 管理员批准申请，确认状态变为 APPROVED
3. 管理员拒绝申请，确认状态变为 REJECTED 且有审批意见
4. 测试筛选功能：按状态筛选请假记录

---

### 步骤 2.6：创建薪资模型与 API

**实施指示**：
1. 在 `salaries/models.py` 中创建模型：
   - `SalaryRecord` 模型：薪资记录（employee, year_month, base_salary, position_allowance, overtime_pay, deductions, total_salary, status）
   - `Appeal` 模型：异常申诉（type 枚举：ATTENDANCE, SALARY；employee, target_id, reason, status, approver, approval_remark）
2. 创建序列化器和视图集
3. 实现接口：
   - 薪资生成接口：根据考勤数据自动计算月薪
   - 薪资列表接口：支持按月份和员工筛选
   - 薪资申诉接口：员工提交异议
   - 申诉处理接口：管理员处理申诉
4. **薪资计算逻辑**（按月生成）：
   - 日工资 = 月基本工资 ÷ 21.75
   - 时薪 = 日工资 ÷ 8
   - 出勤天数 = 当月实际出勤天数（从排班和考勤记录统计）
   - 加班费 = 时薪 × 1.5 × 当月总加班小时数
   - 迟到扣款 = 迟到次数 × 20 元
   - 缺卡扣款 = 缺卡次数 × 50 元
   - 岗位津贴 = 根据员工岗位的固定津贴
   - 实发工资 = 基本工资 + 岗位津贴 + 加班费 - 迟到扣款 - 缺卡扣款
5. 配置 URL 路由

**测试验证**：
1. 触发薪资生成，确认计算正确：
   - 验证日工资 = 月薪 ÷ 21.75
   - 验证加班费 = 时薪 × 1.5 × 加班时长
   - 验证迟到扣款 = 20 × 迟到次数
   - 验证缺卡扣款 = 50 × 缺卡次数
2. 员工提交薪资申诉，确认创建成功
3. 管理员处理申诉，确认状态更新

---

### 步骤 2.7：创建统计分析接口

**实施指示**：
1. 在 `statistics/views.py` 中实现统计接口：
   - 人员统计：总人数、岗位分布、持证率
   - 考勤统计：出勤率、迟到统计、缺卡统计
   - 薪资统计：月度薪资支出趋势
2. 每个接口返回适合 ECharts 渲染的数据格式
3. 配置 URL 路由

**测试验证**：
1. 调用人员统计接口，确认返回数据包含各岗位人数
2. 调用考勤统计接口，确认返回出勤率数据
3. 调用薪资统计接口，确认返回月度趋势数据

---

## 第三阶段：前端公共模块 使用 skills `frontend-design` 前端是web页面，PC端

### 步骤 3.1：创建登录页面

**实施指示**：
1. 在 `src/views/auth/` 创建 `LoginView.vue`
2. 设计表单：
   - 账号输入框
   - 密码输入框
   - 登录按钮
   - "忘记密码"提示文字
3. 表单验证：账号和密码必填
4. 登录逻辑：
   - 调用后端登录接口
   - 保存用户信息和 token 到 localStorage
   - 根据角色跳转：ADMIN → 管理员首页，EMPLOYEE → 员工首页
5. UI 设计：
   - 使用暖色调背景（橙色渐变）
   - 添加食堂相关图标（餐具、厨师帽等）
   - 卡片式登录框，居中显示

**测试验证**：
1. 访问登录页面，确认 UI 显示正常
2. 输入错误账号密码，显示错误提示
3. 使用管理员账号登录，确认跳转到管理员首页
4. 使用员工账号登录，确认跳转到员工首页

---

### 步骤 3.2：创建注册页面

**实施指示**：
1. 在 `src/views/auth/` 创建 `RegisterView.vue`
2. 设计表单：
   - 用户名输入框
   - 密码输入框
   - 确认密码输入框
   - 手机号输入框
   - 邮箱输入框
   - 注册按钮
3. 表单验证：
   - 所有字段必填
   - 两次密码一致
   - 手机号格式正确
   - 邮箱格式正确
4. 注册逻辑：
   - 调用后端注册接口
   - 成功后跳转到登录页
5. UI 设计：与登录页风格一致

**测试验证**：
1. 测试表单验证：密码不一致时显示错误
2. 提交注册，确认创建成功
3. 使用新账号登录，确认可以正常登录

---

### 步骤 3.3：配置路由与导航守卫

**实施指示**：
1. 在 `src/router/index.js` 配置路由：
   - /login → LoginView
   - /register → RegisterView
   - /admin/* → 管理员端页面
   - /employee/* → 员工端页面
2. 添加导航守卫：
   - 未登录用户访问受保护页面，重定向到登录页
   - 已登录用户访问登录页，重定向到对应角色首页
   - 根据用户角色限制访问（管理员不能访问员工端，反之亦然）
3. 在 `src/stores/user.js` 创建用户状态管理：
   - 保存用户信息
   - 退出登录方法

**测试验证**：
1. 未登录访问管理员页面，自动跳转到登录页
2. 登录后访问登录页，自动跳转到对应首页
3. 员工账号尝试访问管理员页面，显示权限不足

---

## 第四阶段：管理员端页面

### 步骤 4.1：管理员首页（Dashboard）

**实施指示**：
1. 在 `src/views/admin/` 创建 `DashboardView.vue`
2. 设计页面布局：
   - 顶部：欢迎语 + 日期显示
   - 快捷入口区域：4 个卡片（人员新增、排班制定、考勤异常处理、薪资生成）
   - 今日概览区域：3 个统计卡片（今日应到/实到、今日请假、今日异常）
   - 待办事项区域：列表显示待审批的请假、调班、申诉
3. 创建对应的 API 调用方法
4. UI 设计：
   - 使用食堂主题配色
   - 卡片使用圆角和阴影
   - 图标使用餐具、厨师帽等元素

**测试验证**：
1. 访问管理员首页，确认所有数据正确显示
2. 点击快捷入口卡片，确认跳转到对应页面
3. 刷新页面，确认数据重新加载

---

### 步骤 4.2：人员档案管理页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `EmployeeManageView.vue`
2. 设计页面结构：
   - 顶部操作栏：新增按钮 + 搜索框 + 筛选器（岗位、状态）
   - 员工列表表格：显示姓名、性别、岗位、手机号、入职日期、状态、操作
   - 分页组件
3. 创建新增/编辑对话框：
   - 基础信息标签页：姓名、性别、手机、身份证、地址
   - 岗位信息标签页：岗位、入职日期、状态
   - 资质证书标签页：健康证号、有效期、厨师等级证
4. 创建详情对话框：展示完整档案信息
5. 实现删除确认对话框
6. UI 设计：
   - 岗位列使用彩色标签（厨师-橙色、保洁-绿色等）
   - 状态列使用不同颜色徽章

**测试验证**：
1. 新增员工，确认保存成功且列表更新
2. 编辑员工信息，确认更新成功
3. 按岗位筛选，确认只显示对应岗位员工
4. 删除员工，确认弹出确认对话框且删除成功

---

### 步骤 4.3：排班安排管理页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `ScheduleManageView.vue`
2. 设计页面结构：
   - 顶部：日期选择器 + 视图切换（列表/日历）
   - 日历视图：使用 Element Plus 日历组件，显示每日排班情况
   - 列表视图：表格显示排班记录
   - 批量排班对话框：选择员工、日期范围、班次
3. 创建调班审核对话框：
   - 显示申请详情
   - 批准/拒绝按钮
   - 审批意见输入框
4. 实现排班拖拽功能（可选）
5. UI 设计：
   - 日历中不同班次使用不同颜色
   - 已调班的排班显示特殊标记

**测试验证**：
1. 切换日历/列表视图，确认显示正常
2. 批量为多个员工创建排班，确认全部创建成功
3. 审核调班申请，批准后确认排班自动更新
4. 拖拽排班（如已实现），确认可以移动到其他日期

---

### 步骤 4.4：考勤记录管理页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `AttendanceManageView.vue`
2. 设计页面结构：
   - 顶部：日期选择器 + 筛选器（员工、状态）
   - 考勤记录表格：显示姓名、日期、签到时间、签退时间、状态、操作
   - 统计区域：迟到次数、缺卡次数、加班时长
3. 创建异常处理对话框：
   - 显示考勤详情
   - 状态修改下拉框
   - 修改备注输入框（必填）
4. 实现导出功能（可选）
5. UI 设计：
   - 不同状态的考勤使用不同颜色行
   - 异常记录高亮显示

**测试验证**：
1. 查看某日考勤记录，确认数据显示正确
2. 修改异常考勤状态，确认更新成功且有备注
3. 按状态筛选，确认只显示对应状态记录
4. 查看统计数据，确认计算正确

---

### 步骤 4.5：请假审批管理页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `LeaveApproveView.vue`
2. 设计页面结构：
   - 顶部：状态 Tab 切换（待审批、已通过、已驳回、全部）
   - 请假申请列表：显示员工、类型、时间、原因、状态、操作
3. 创建审批对话框：
   - 显示申请详情
   - 通过/拒绝按钮
   - 审批意见输入框
4. UI 设计：
   - 不同状态使用不同颜色标签
   - 待审批项高亮显示

**测试验证**：
1. 查看待审批列表，确认显示所有待处理申请
2. 批准请假申请，确认状态变为已通过
3. 驳回请假申请，确认状态变为已驳回且有审批意见
4. 切换 Tab，确认只显示对应状态记录

---

### 步骤 4.6：薪资信息管理页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `SalaryManageView.vue`
2. 设计页面结构：
   - 顶部：月份选择 + 生成薪资按钮
   - 薪资列表：显示员工、月份、基本工资、津贴、加班费、扣款、实发工资、状态、操作
3. 创建异常处理对话框：
   - 显示薪资详情
   - 手动调整金额输入框
   - 调整原因输入框
4. 创建薪资申诉处理对话框
5. 实现导出工资表功能
6. UI 设计：
   - 金额列右对齐，保留两位小数
   - 不同状态使用不同颜色

**测试验证**：
1. 选择月份并点击生成，确认所有员工薪资计算正确
2. 处理薪资申诉，确认调整后金额更新
3. 导出工资表，确认文件格式正确
4. 按月份筛选，确认只显示对应月份记录

---

### 步骤 4.7：综合统计分析页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `StatisticsView.vue`
2. 设计页面结构：
   - 顶部统计卡片：总人数、今日出勤率、本月薪资支出
   - 人员统计区域：
     - 岗位分布饼图
     - 持证率统计
   - 考勤统计区域：
     - 出勤率折线图（最近7天）
     - 岗位缺勤排行柱状图
   - 薪资统计区域：
     - 月度薪资支出趋势图
3. 使用 ECharts 渲染图表
4. UI 设计：
   - 图表配色使用食堂主题暖色调
   - 图表区域使用卡片包裹

**测试验证**：
1. 刷新页面，确认所有图表渲染正常
2. 鼠标悬停图表，确认显示提示信息
3. 切换日期范围，确认图表数据更新

---

### 步骤 4.8：系统管理页面

**实施指示**：
1. 在 `src/views/admin/` 创建 `SystemManageView.vue`
2. 设计页面结构：
   - 左侧菜单：用户账号、角色权限、系统设置
   - 右侧内容区域：根据左侧选择显示不同内容
3. 用户账号管理：
   - 表格显示所有用户账号
   - 新增/编辑对话框：账号、密码、关联员工、角色、状态
   - 注意：与人员档案区分，账号是登录凭证，档案是业务信息
4. 角色权限管理（简化版）：
   - 列表显示角色
   - 权限勾选框（如需）
5. 系统基础设置：
   - 考勤规则设置：迟到阈值（分钟）
   - 默认班次时间配置
6. UI 设计：与其他管理页面风格一致

**测试验证**：
1. 新增用户账号，确认可以正常登录
2. 禁用用户账号，确认无法登录
3. 修改考勤规则，确认生效

---

## 第五阶段：员工端页面
> 每次新建页面，记得创建相关路由

### 步骤 5.1：员工端首页

**实施指示**：
1. 在 `src/views/employee/` 创建 `HomeView.vue`
2. 设计页面结构：
   - 顶部：欢迎语 + 员工姓名
   - 排班卡片区域：
     - 今日排班：显示班次名称和时间
     - 明日排班：显示班次名称和时间
     - 休息日显示"今日休息"
   - 快捷入口区域：4 个按钮（签到、请假、调班、工资条）
   - 通知公告区域：显示审批结果、申诉反馈
3. 创建对应的 API 调用方法
4. UI 设计：
   - 卡片式布局，圆角设计
   - 使用暖色调
   - 图标使用食堂元素

**测试验证**：
1. 访问员工首页，确认今日排班显示正确
2. 点击快捷入口按钮，确认跳转到对应页面
3. 有新通知时，确认显示未读标记

---

### 步骤 5.2：个人信息中心页面

**实施指示**：
1. 在 `src/views/employee/` 创建 `ProfileView.vue`
2. 设计页面结构：
   - 个人信息展示：姓名、性别、岗位、手机号、身份证、地址、入职日期
   - 岗位信息展示：岗位名称、在职状态
   - 证书信息展示：
     - 健康证：证书号、有效期（即将到期时高亮提示）
     - 厨师等级证（如有）
   - 密码修改区域：旧密码、新密码、确认密码
3. 密码修改逻辑：
   - 验证旧密码
   - 新密码强度提示
   - 确认密码一致
4. UI 设计：
   - 信息分组展示，使用卡片
   - 证书即将到期（30天内）显示警告色

**测试验证**：
1. 查看个人信息，确认与管理员录入的档案一致
2. 修改密码，确认新密码可以登录
3. 旧密码错误时，显示错误提示

---

### 步骤 5.3：签到服务页面

**实施指示**：
1. 在 `src/views/employee/` 创建 `CheckInView.vue`
2. 设计页面结构：
   - 大号签到/签退按钮（根据当前状态切换）
   - 当前时间显示
   - 今日签到记录：签到时间、签退时间、状态
   - 签到日历：日历视图显示当月打卡情况（正常-绿色，异常-红色）
3. 签到逻辑：
   - 获取当前时间
   - 获取位置（浏览器定位 API）
   - 调用签到接口
4. UI 设计：
   - 大按钮方便点击
   - 日历使用圆点标记打卡状态

**测试验证**：
1. 点击签到按钮，确认记录创建成功
2. 签到后按钮变为"签退"
3. 查看签到日历，确认今日标记为绿色

---

### 步骤 5.4：考勤信息查询页面

**实施指示**：
1. 在 `src/views/employee/` 创建 `AttendanceView.vue`
2. 设计页面结构：
   - 月份选择器
   - 考勤记录列表：日期、签到时间、签退时间、状态
   - 异常上报按钮（异常记录显示）
   - 统计信息：迟到次数、缺卡次数、加班时长
3. 创建异常上报对话框：
   - 显示异常详情
   - 异常说明输入框
4. UI 设计：
   - 异常记录使用红色背景
   - 列表可滚动

**测试验证**：
1. 查看本月考勤记录，确认显示正确
2. 对异常记录提交上报，确认创建成功
3. 切换月份，确认数据更新

---

### 步骤 5.5：请假申请服务页面

**实施指示**：
1. 在 `src/views/employee/` 创建 `LeaveView.vue`
2. 设计页面结构：
   - 顶部：新增请假按钮
   - Tab 切换：申请记录、审批中、已通过、已驳回
   - 请假记录列表：类型、时间、原因、状态、审批意见
3. 创建请假申请对话框：
   - 请假类型选择（事假/病假/调休）
   - 开始/结束时间选择器
   - 请假原因输入框
4. UI 设计：
   - 不同状态使用不同颜色标签
   - 审批意见在驳回时显示

**测试验证**：
1. 提交请假申请，确认创建成功且状态为审批中
2. 查看审批结果，确认状态更新
3. 被驳回的申请显示审批意见

---

### 步骤 5.6：调班申请服务页面

**实施指示**：
1. 在 `src/views/employee/` 创建 `ShiftSwapView.vue`
2. 设计页面结构：
   - 顶部：新增调班申请按钮
   - 调班记录列表：原班次、期望调整、原因、状态
   - 我的排班列表：显示未来排班，方便选择
3. 创建调班申请对话框：
   - 选择原定班次（从我的排班中选择）
   - 选择目标日期和班次
   - 申请原因输入框
4. UI 设计：与请假页面风格一致

**测试验证**：
1. 提交调班申请，确认创建成功
2. 查看调班结果，管理员批准后显示"已通过"
3. 被驳回的申请显示拒绝原因

---

### 步骤 5.7：薪资信息查询页面

**实施指示**：
1. 在 `src/views/employee/` 创建 `SalaryView.vue`
2. 设计页面结构：
   - 顶部：月份选择器
   - 当月工资卡片：
     - 基本工资
     - 岗位津贴
     - 加班费
     - 扣款
     - 实发工资（大号显示）
     - 默认脱敏显示，点击"小眼睛"图标查看详情
   - 薪资申诉按钮
3. 创建薪资申诉对话框：
   - 选择申诉月份
   - 申诉原因输入框
4. UI 设计：
   - 工资金额使用大号字体
   - 脱敏时显示 ****

**测试验证**：
1. 查看当月工资，确认默认脱敏
2. 点击"小眼睛"，确认显示具体金额
3. 提交薪资申诉，确认创建成功

---

## 第六阶段：UI/UX 优化与细节调整

### 步骤 6.1：应用食堂主题全局样式

**实施指示**：
1. 在 `src/styles/` 创建主题文件 `theme.css`：
   - 定义 CSS 变量：
     ```css
     :root {
       --primary-color: #FF6B35;      /* 主色 - 橙色 */
       --secondary-yellow: #F7C52D;   /* 辅助色 - 黄色 */
       --secondary-green: #4CAF50;    /* 辅助色 - 绿色 */
       --bg-color: #FFF8F0;           /* 背景色 - 浅米色 */
       --text-color: #333333;         /* 文字色 - 深灰 */
       --border-radius: 8px;          /* 圆角 */
       --spacing: 16px;               /* 间距 */
     }
     ```
   - 定义字体大小、间距、圆角等设计变量
2. 在 `main.js` 中全局引入主题文件
3. 创建食堂主题组件或图标：
   - 使用自定义 SVG 图标或 Element Plus 图标组合
   - 餐具图标（刀叉、勺子）
   - 厨师帽图标
   - 食材图标（蔬菜、水果）
4. 调整 Element Plus 主题色，覆盖默认 CSS 变量
5. 应用主题到所有页面组件

**测试验证**：
1. 打开任意页面，确认配色符合食堂主题
2. 使用浏览器开发工具检查，确认 CSS 变量正确应用
3. 检查所有按钮、卡片、标签使用主题色
4. 确认图标使用食堂相关元素
5. 确认整体视觉效果温馨、有食堂辨识度

---

### 步骤 6.2：响应式设计优化

**实施指示**：
1. 为所有页面（管理端和员工端）添加响应式设计
2. 设计断点：
   - 小屏幕：< 1200px（调整布局）
   - 中等屏幕：1200px - 1440px
   - 大屏幕：> 1440px
3. 调整字体大小：小屏幕适度放大（考虑到部分员工年龄偏大）
4. 调整按钮和表单：
   - 小屏幕下按钮更大，方便点击
   - 表单使用垂直布局
5. 测试不同屏幕尺寸：笔记本、台式机显示器

**测试验证**：
1. 使用浏览器开发者工具模拟不同分辨率
2. 确认所有元素在不同屏幕尺寸下正常显示
3. 确认表格在小屏幕下可横向滚动
4. 确认文字清晰可读，按钮易于点击

---

### 步骤 6.3：添加加载状态与错误处理

**实施指示**：
1. 在所有 API 请求中添加 loading 状态
2. 添加全局错误处理：
   - 网络错误提示
   - 服务器错误提示
   - 权限错误提示
3. 添加空状态提示：
   - 无数据时显示空状态插图
4. 添加操作成功/失败提示

**测试验证**：
1. 断开网络，确认显示网络错误提示
2. 请求接口时，确认显示 loading 动画
3. 操作成功后，确认显示成功提示

---

### 步骤 6.4：管理员端菜单与布局

**实施指示**：
1. 创建管理员端布局组件：
   - 左侧菜单栏：显示所有管理模块
   - 顶部导航栏：用户信息、退出登录
   - 内容区域：显示当前页面
2. 菜单项包括：
   - 首页
   - 人员档案管理
   - 排班安排管理
   - 考勤记录管理
   - 请假审批管理
   - 薪资信息管理
   - 综合统计分析
   - 系统管理
3. 使用食堂主题图标

**测试验证**：
1. 点击菜单项，确认页面切换正常
2. 当前页面菜单项高亮显示
3. 退出登录，确认跳转到登录页

---

### 步骤 6.5：员工端导航栏

**实施指示**：
1. 创建员工端侧边导航组件：
   - 首页
   - 个人信息
   - 签到服务
   - 考勤查询
   - 请假申请
   - 调班申请
   - 薪资查询
2. 导航栏固定在左侧，适合 PC 端操作
3. 当前页面菜单项高亮显示
4. 顶部导航栏：显示员工姓名、退出登录按钮

**测试验证**：
1. 点击导航菜单，确认页面切换
2. 当前页面菜单项高亮显示
3. 退出登录，确认跳转到登录页
4. 导航栏不遮挡页面内容

---

## 第七阶段：集成测试与优化

### 步骤 7.1：端到端流程测试

**测试项目**：
1. **管理员注册员工并创建账号流程**：
   - 管理员登录 → 创建员工档案 → 创建账号 → 员工可登录
2. **排班到考勤流程**：
   - 管理员创建排班 → 员工签到 → 管理员查看考勤记录
3. **请假申请流程**：
   - 员工提交请假 → 管理员审批 → 员工查看结果
4. **调班申请流程**：
   - 员工提交调班 → 管理员审核 → 排班自动更新
5. **薪资生成与申诉流程**：
   - 管理员生成薪资 → 员工查看 → 提交申诉 → 管理员处理

**测试验证**：
每个流程从头到尾执行一遍，确认无错误

---

### 步骤 7.2：性能测试与优化

**测试项目**：
1. 测试大量数据加载：
   - 创建 100+ 员工档案
   - 创建 1000+ 考勤记录
   - 确认页面加载时间 < 2 秒
2. 测试并发打卡：
   - 模拟多个员工同时签到
   - 确认所有请求成功

**优化措施**：
- 添加分页
- 添加列表虚拟滚动（如需要）
- 添加 API 响应缓存（适当）

---

### 步骤 7.3：安全性检查

**检查项目**：
1. 确认普通员工无法访问管理员端页面
2. 确认未登录用户无法访问受保护页面
3. 确认薪资数据默认脱敏
4. 确认密码在开发阶段为明文（符合需求）
5. 确认敏感操作需要确认（删除、审批等）

---

### 步骤 7.4：最终验收测试

**验收标准**：
1. 所有 PRD 中描述的功能均已实现
2. 所有 UI 设计符合食堂主题（橙黄绿暖色调、食堂元素图标）
3. 响应式设计良好，适配不同屏幕尺寸
4. 无明显 Bug
5. 数据流转正确（排班→考勤→薪资）
6. 权限控制正确
7. 薪资计算符合公式：月薪÷21.75×出勤天数 + 岗位津贴 + 加班费 - 迟到扣款 - 缺卡扣款
8. 考勤判断符合规则：5分钟弹性时间

---

## 附录：重要注意事项

### 1. 人员档案 vs 用户账号
- **人员档案**（EmployeeProfile）：业务层面的员工信息，用于排班、考勤、薪资
- **用户账号**（User）：登录系统的账号，与员工档案是可选关联
- 并非所有员工都需要账号（如大龄保洁人员）

### 2. 食堂主题元素
- 配色方案：
  - 主色：橙色 #FF6B35
  - 辅助色：黄色 #F7C52D、绿色 #4CAF50
  - 背景色：浅米色 #FFF8F0
- 图标：餐具、厨师帽、食材等食堂元素
- 字体：清晰易读

### 3. 薪资计算规则详解
```
日工资 = 月基本工资 ÷ 21.75
时薪 = 日工资 ÷ 8
加班费 = 时薪 × 1.5 × 加班小时数
迟到扣款 = 20 元 × 迟到次数
缺卡扣款 = 50 元 × 缺卡次数
实发工资 = 基本工资 + 岗位津贴 + 加班费 - 迟到扣款 - 缺卡扣款
```

### 4. 考勤判断规则详解
```
弹性时间：班次开始时间 ± 5 分钟内不算迟到/早退
迟到：签到时间 > 班次开始时间 + 5 分钟
早退：签退时间 < 班次结束时间 - 5 分钟
缺卡：当天无签到记录或无签退记录
加班：签退时间 > 班次结束时间（计算超出的小时数）
```

### 5. 密码存储
- 开发阶段使用明文存储
- 生产环境需改为加密存储

### 6. 权限控制
- 管理员：所有管理功能
- 员工：仅个人相关功能和查看权限

### 7. 自动跳转
- 登录后根据角色自动跳转：ADMIN → 管理员首页，EMPLOYEE → 员工首页

### 8. 数据库管理
- 使用 Django migrations 管理数据库
- 表结构参考 `init_db.sql`，但不直接执行 SQL 文件
- 所有表结构变更通过 migrations 完成

---

**文档版本**: V1.1
**最后更新**: 2026-01-27
**更新内容**：
- 添加薪资计算详细规则（21.75天折算、加班1.5倍、迟到扣20元、缺卡扣50元）
- 添加考勤判断详细规则（5分钟弹性时间）
- 明确 UI 主题配色方案（#FF6B35、#F7C52D、#4CAF50、#FFF8F0）
- 明确前端策略为 PC 端响应式设计（非移动端优先）
- 明确数据库使用 Django migrations（不直接执行 SQL 文件）
